---
# yaml-language-server: $schema=https://raw.githubusercontent.com/datreeio/CRDs-catalog/main/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: filebrowser
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden-fields
  target:
    name: filebrowser-config
    creationPolicy: Owner
    template:
      data:
        config.yaml: |
          frontend:
            name: "Filebrowser"
            disableDefaultLinks: true
          auth:
            methods:
              password:
                enabled: false
              oidc:
                enabled: true
                clientId: filebrowser
                clientSecret: "{{.client_secret}}"
                issuerUrl: "https://idm.lucadev.de/oauth2/openid/filebrowser"
                scopes: "openid email profile groups"
                createUser: true
                adminGroup: "admins@idm.lucadev.de"
                groupsClaim: "groups"
          server:
            database: /db/filebrowser.db
            cacheDir: /cache
            sources:
              - path: "/mnt/media"
                config:
                  defaultEnabled: true
              - path: "/mnt/public"
                config:
                  defaultEnabled: true
              - path: "/mnt/homes"
                config:
                  defaultUserScope: "/"
                  defaultEnabled: true
                  createUserDir: true
  data:
    - secretKey: client_secret
      remoteRef:
        key: filebrowser
        property: OIDC_SECRET
